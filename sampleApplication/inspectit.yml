# https://inspectit.github.io/inspectit-ocelot/docs/instrumentation/rules#actions

inspectit:

  metrics:
    enabled: false

  instrumentation:
    scopes:
      allClasses:
        type: {name: net.explorviz.sampleApplication, matcher-mode: STARTS_WITH_IGNORE_CASE}

    rules:
      all_methods_no_input_return:
        scopes:
          allClasses: true
        tracing:
            start-span: true
            attributes:
              monitoring_id: monitoring_id_attr
              host: host_name_attr
              method_fqn: method_fqn_attr
              application_name: appname_attr
        entry:
          host_name_attr:
           action: get_host_name
          method_fqn_attr:
            action: get_method_fqn
          appname_attr:
            action: set
            constant-input:
              value: "UNKNOWN-APPLICATION"
          monitoring_id_attr:
            action: create_or_get_UUID

    actions:

      #computes a nanosecond-timestamp as a long for the current point in time
      get_host_name:
        imports:
          - java.net.InetAddress
        value-body: |
          InetAddress ip = InetAddress.getLocalHost();
          return ip.getHostName();

      get_method_fqn:
        input:
          _methodName: String
          _class: Class
        value: "new StringBuilder(_class.getName()).append('.').append(_methodName).toString()"

      create_or_get_UUID:
        imports:
          - java.lang.management.ManagementFactory
        input:
          _context: InspectitContext
        value: "ManagementFactory.getRuntimeMXBean().getName()"

  logging:
    debug: true
    trace: false

  exporters:
    tracing:
      open-census-agent:
        address: "localhost:55678"
        service-name: "Alex sein Test - OpenCensus"
        use-insecure: true
      zipkin:
        url: http://127.0.0.1:9411/api/v2/spans
